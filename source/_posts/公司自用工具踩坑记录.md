---
title: 公司自用工具踩坑记录
date: 2016-08-23 20:07:25
tags: [Hundsun]
category: [踩坑记录]
---
恒生用的系统大部分都是自己魔改过的东西, 比如从网页端操作数据库就需要先调用公司的网页框架 Jres, 将数据(包括请求的参数和要调用的功能号)通过 Filter 封装以后, 以 T2 协议向数据库中间件 Cres 发送. Cres 接收之后进行解包, 依据功能号调用对应的功能, 并将接收到的参数进行入参. 而 Cres 上的功能则由 Ares 编写. Ares 是一款 IDE, 代码编写主要是通过宏定义的伪代码, 然后拼接成 C++ 程序, 再用 NetBeans 传上服务器编译为 *.so 文件. 在服务器上修改 *_ar.xml 和 *_ls.xml 来对特定功能号的 component 进行路由规则制定和添加处理模块. 实习期间应该都会一直更新.
<!--more-->
## Ares 方面
### 变量名未定义
伪代码的问题, 因为是用类似于 `[结果集语句][select * from t_demo][t_demo]` 这种宏定义的东西拼接成 C 语言代码, 所以很容易出现变量名未定义的 Bug, 没办法, 只能慢慢看.
### 接口
接口定义的参数分为三种: 标准字段, 对象类型, 参数组. 标准字段就是数据库的字段类型. 对象类型需要自己定义, 类似于 JavaBean, 里面包含的是标准字段, 通常将对象类型名取为 rows. 参数组类似于标准字段, 是规定了包含什么参数的一组字段. 如果是查询功能的话, 需要打开[返回结果集]功能, 就是 ResultSet. 

## Cres 方面
### 更改不生效
在从 NetBeans 上传源码并编译为 *.so 文件之后, 需要对 pub 进行重启, 否则无法调用更改后的功能.

## Jres 方面
### 返回结果集解包
这个东西坑了我差不多一天... 接口定义的返回参数中, 标准字段对应的要么是 char, 要么是 Integer, 这些可以从其他代码中获知. 如果接口定义的返回参数多于一个, 就需要用 *DTO(extends BaseDTO) 来接收, 而如果是 rows 这种对象类型, 则对应的类型是 List<RowstypeDTO>. 比如我要查询的东西返回内容是:
```js
row_count;
rows[func_id, func_name, remark];

ConnectTestDTO:
Integer func_id;
String func_name, remark;
```
则对应的接收 DTO 应为:
```js
Integer rowCount;
List<ConnectTestDTO> rows;
```
在 Java 中定义的变量名与 Ares 中的标准字段名对应是用驼峰替代下划线, 如 `funcName -> func_name`.